import{j as e}from"./jsx-runtime.D3GSbgeI.js";import{r as n}from"./index.By4mQp_K.js";import{h as le,Q as U,c as ue,r as de}from"./quizAttempts.YEtxDKvE.js";import{f as Z,g as me,h as pe,i as X}from"./config.BXJrpnhT.js";import{s as A,a as d,b as Q,c as v}from"./index.cf789433.BdR8826T.js";import z from"./primaryCta.Ci9AiSi1.js";import{A as E,m as k}from"./index.BtZCIqQt.js";import{L as fe,q as C}from"./index.vnQZnI02.js";import{L as he}from"./logo-white.BPv_DBD2.js";import"./index.yBjzXJbu.js";import"./index.85335ed5.Mz1AKNAk.js";import"./index.62dcdcc3.FTzKahtF.js";import"./index.953e91d7.D2evhJDA.js";import"./runtime.D4r9TE2O.js";const ge=async r=>{console.log({db:Z,data:r});try{const o=await me(pe(Z,"submissions"),r);return console.log({docRef:o}),o.id}catch(o){throw console.error("Error saving quiz result:",o),o}},ye=({currentStep:r,steps:o,completedQuestions:c,hasAnswered:h})=>{const a=b=>{const m=b+1;return c.includes(m)?A.completedStep:m===r&&h?A.halfStep:""};return e.jsx("div",{className:A.container,children:e.jsx("div",{className:A.steps,children:Array.from({length:o},(b,m)=>e.jsx("div",{className:`${A.step} ${a(m)}`},m))})})},xe=()=>{const[r,o]=n.useState(!1);return n.useEffect(()=>{const c=()=>{o(window.innerWidth<400)};return c(),window.addEventListener("resize",c),()=>window.removeEventListener("resize",c)},[]),r},we=()=>{const[r,o]=n.useState(!1);return n.useEffect(()=>{const c=()=>{o(window.innerWidth>1200)};return c(),window.addEventListener("resize",c),()=>window.removeEventListener("resize",c)},[]),r},be=({question:r,answer:o,handleAnswerClick:c,id:h,setNextQuestion:a,ifYes:b,ifNo:m})=>{const g=we(),S=xe(),q=g?.8:S?.7:.85;console.log({isDesktop:g,scale:q});const[y,L]=n.useState(!1),[N,P]=n.useState(""),[x,$]=n.useState(!1),l=(w,p)=>{L(!0),P(p),c(w,p)},V=(w,p)=>{a(w)},M={hidden:{y:"0%",scale:1,opacity:0,transformOrigin:g?"bottom":S?"top":"bottom",transition:{type:"spring",bounce:.25,duration:.8}},unanswered:{y:"0%",scale:1,opacity:1,transformOrigin:g?"bottom":S?"top":"bottom",transition:{type:"spring",bounce:.25,duration:.8}},answered:{top:150,y:"0%",scale:[1,q],opacity:[1,.5],transformOrigin:g?"bottom":S?"top":"bottom",transition:{duration:.8,times:[0,1],ease:"easeInOut"}},exit:{top:150,scale:q,y:"0%",opacity:.5,transformOrigin:"bottom",transition:{type:"spring",bounce:.25,duration:.8}}},F={hidden:{x:N==="yes"?"-100%":"100%",opacity:0},visible:{x:0,opacity:1,transition:{type:"spring",bounce:.25,duration:.8,delay:.5,ease:[0,.71,.2,1.01]}},exit:{x:"-100%",opacity:0,transition:{duration:.5}}},T={hidden:{opacity:0,y:15},visible:w=>({opacity:1,y:0,transition:{type:"spring",bounce:.25,delay:w*.08,duration:2,ease:[0,.71,.2,1.01]}})},O=r.split(" ");return e.jsx(e.Fragment,{children:e.jsxs("div",{className:d.questions,children:[e.jsx(E,{mode:"wait",children:e.jsxs(k.div,{variants:M,animate:y?"answered":"unanswered",initial:"hidden",exit:"exit",className:d.question,children:[e.jsx("h2",{className:d.questionFont,children:O.map((w,p)=>e.jsx(k.span,{custom:p,variants:T,initial:"hidden",animate:"visible",style:{display:"inline-block",marginRight:"0.25em"},children:w},p))}),!y&&e.jsxs("div",{className:`${d.buttonGroup} ${d.buttonGroupYesNo}`,children:[e.jsx(z,{onClick:()=>l(h,"yes"),label:"Yes"}),e.jsx(z,{onClick:()=>l(h,"no"),label:"No"})]})]},h)}),e.jsx(E,{mode:"wait",children:y&&e.jsxs(k.div,{variants:F,initial:"hidden",animate:"visible",exit:"exit",className:d.answer,children:[e.jsx("h3",{className:d.answerFont,children:N==="yes"?b.answer:m.answer}),e.jsx("h3",{className:d.answerFont,dangerouslySetInnerHTML:{__html:o}})]})}),y&&!x?e.jsx("div",{className:`${d.buttonGroup} ${d.buttonGroupNext}`,children:e.jsx(z,{onClick:()=>V(h),label:"Next"})}):null]})})},je=({currentQuestion:r,handleGoBack:o})=>e.jsxs("header",{className:Q.container,children:[e.jsx("a",{href:"/",className:Q.logo,children:e.jsx("img",{className:Q.logo,src:he.src,alt:"Penington Institute"})}),r>1&&e.jsx("button",{className:Q.backButton,onClick:o,children:"Back"})]}),ve="Enter your postcode to get your results.",Fe=()=>{const[r,o]=n.useState(!1),c=ve.split(" "),h={hidden:{opacity:0,y:15},visible:t=>({opacity:1,y:0,transition:{type:"spring",bounce:.25,delay:t*.15,duration:2,ease:[0,.71,.2,1.01]}})},[a,b]=n.useState(1),[m,g]=n.useState(!1),S=()=>{ne?K(!1):b(a+1),g(!1)},[q,y]=n.useState(!1),[L,N]=n.useState([]),P=t=>{y(!1),N(s=>[...s.filter(u=>u<t),t]),g(!0)},[x,$]=n.useState(["","","",""]),l=[n.useRef(null),n.useRef(null),n.useRef(null),n.useRef(null)],V=(t,s)=>{const i=s.target.value;if(!/^\d*$/.test(i))return;const u=[...x];u[t]=i,$(u),i.length===1&&t<3&&l[t+1].current&&l[t+1].current?.focus()},M=(t,s)=>{s.key==="Backspace"&&x[t]===""&&t>0&&l[t-1].current&&l[t-1].current?.focus(),s.key==="ArrowLeft"&&t>0&&l[t-1].current&&l[t-1].current?.focus(),s.key==="ArrowRight"&&t<3&&l[t+1].current&&l[t+1].current?.focus()},F=t=>{t.preventDefault();const s=t.clipboardData.getData("text").replace(/\D/g,"").slice(0,4),i=[...x];[...s].forEach((f,R)=>{R<4&&(i[R]=f)}),$(i);const u=i.findIndex(f=>f==="");l[u===-1?3:u].current?.focus()},[T,O]=n.useState(!0),[w,p]=n.useState(!1),[Se,Y]=n.useState(null),[Ne,I]=n.useState("");n.useEffect(()=>{(()=>{console.log("checking");try{const s=le(U);if(s){const i=s;p(!0),Y(i),I("You have already completed this quiz")}}catch(s){console.error("Error checking previous attempt:",s),I("Error checking quiz status")}finally{O(!1)}})()},[]);const[D,ee]=n.useState({createdAt:X(),postCode:"",answers:{q1:null,q2:null,q3:null,q4:null,q5:null},results:{r1:0,r2:0}}),[te,_]=n.useState(!1),[ke,G]=n.useState("idle"),se=async t=>{t.preventDefault(),o(!0),_(!0),G("submitting");try{const s={postCode:x.join(""),createdAt:X(),answers:{q1:j[1],q2:j[2],q3:j[3],q4:j[4],q5:j[5]},results:{r1:D.results.r1,r2:D.results.r2}};await ge(s),localStorage.setItem("results",JSON.stringify(s.results));const i=localStorage.getItem("cookieAccepted")==="true";console.log({cookiesAccepted:i}),i&&(ue(),await de(U,s.results)),p(!0),Y(s.results),I("Quiz submitted successfully!"),G("success"),window.location.href="/results"}catch(s){console.error("Error submitting quiz:",s),I("Error submitting quiz"),G("error")}finally{_(!1)}},[j,H]=n.useState({}),[ne,K]=n.useState(!1);n.useEffect(()=>{N(t=>t.filter(s=>s<a))},[a]);const ie=(t,s)=>{if(!C.find(f=>f.id===t))return;const u={...j,[t]:s};H(u);const B=Object.entries(u).reduce((f,[R,ae])=>{const W=C.find(ce=>ce.id===Number(R));if(!W)return f;const J=ae==="yes"?W.ifYes:W.ifNo;return{r1:f.r1+J.penington,r2:f.r2+J.victorians}},{r1:0,r2:0});console.log({newResults:B}),ee({...D,results:B})};console.log({formData:D});const oe=()=>{const t={...j};delete t[a],H(t);const s=a-1;N(i=>i.filter(u=>u<s)),K(!0),b(s),y(!1)},re={hidden:{opacity:1,transition:{type:"spring",bounce:.25,duration:.8}},loading:{opacity:1,transition:{type:"spring",bounce:.25,duration:.8}},exit:{opacity:1,transition:{type:"spring",bounce:.25,duration:.8}}};return e.jsxs(e.Fragment,{children:[e.jsx(E,{mode:"wait",children:r&&e.jsx(k.div,{variants:re,animate:te?"loading":"initial",initial:"hidden",exit:"exit",className:v.loadingContainer,children:e.jsx(fe,{resultsPage:!0})})}),e.jsxs("div",{className:v.container,children:[e.jsx(ye,{hasAnswered:q,steps:C.length,currentStep:a,completedQuestions:L}),e.jsx(je,{handleGoBack:oe,currentQuestion:a}),a===C.length+1?e.jsxs("div",{className:v.postCodeContainer,children:[e.jsx(E,{mode:"wait",children:e.jsx("h1",{className:"display2",children:c.map((t,s)=>e.jsx(k.span,{custom:s,variants:h,initial:"hidden",animate:"visible",style:{display:"inline-block",marginRight:"0.25em"},children:t},s))})}),e.jsxs("form",{className:v.form,onSubmit:se,children:[e.jsx("div",{className:v.postCodeWrapper,children:x.map((t,s)=>e.jsx("div",{className:v.postCodeInputWrapper,children:e.jsx("input",{ref:l[s],type:"text",inputMode:"numeric",value:t,maxLength:1,onChange:i=>V(s,i),onKeyDown:i=>M(s,i),onPaste:F},s)}))}),x.join("").length===4&&e.jsx("div",{className:v.getResultsButton,children:e.jsx(z,{type:"submit",label:"Get my results"})})]})]}):e.jsx("div",{id:"questions",children:e.jsx(E,{mode:"wait",onExitComplete:S,children:!m&&e.jsx(k.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.5},children:e.jsx(be,{...C[a-1],handleAnswerClick:(t,s)=>[ie(t,s),y(!0)],setNextQuestion:P})},a)})})]})]})};export{Fe as default};
